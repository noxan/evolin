// Generated by CoffeeScript 1.6.3
(function() {
  var tastypieTransformer;

  this.services = angular.module('evolinServices', ['ngResource']);

  tastypieTransformer = function($http) {
    return $http.defaults.transformResponse.concat([
      function(data, headersGetter) {
        var result;
        result = data.objects;
        result.meta = data.meta;
        return result;
      }
    ]);
  };

  this.services.factory('Issue', [
    '$http', '$resource', function($http, $resource) {
      return $resource('/api/v1/issues/:issueId/', {}, {
        query: {
          cache: true,
          method: 'GET',
          transformResponse: tastypieTransformer($http),
          isArray: true,
          params: {
            issueId: ''
          }
        }
      });
    }
  ]);

  this.app = angular.module('evolinApp', ['ngRoute', 'evolinServices']);

  this.app.config([
    '$routeProvider', function($routeProvider) {
      return $routeProvider.when('/issues', {
        templateUrl: '/static/partials/issues/issue_list.html',
        controller: 'IssueListCtrl'
      }).when('/issues/:issueId', {
        templateUrl: '/static/partials/issues/issue_detail.html',
        controller: 'IssueDetailCtrl'
      }).otherwise({
        redirectTo: '/issues'
      });
    }
  ]);

  this.app.controller('IssueListCtrl', [
    '$scope', 'Issue', function($scope, Issue) {
      return $scope.issues = Issue.query();
    }
  ]);

  this.app.controller('IssueDetailCtrl', [
    '$scope', '$routeParams', 'Issue', function($scope, $routeParams, Issue) {
      return $scope.issues = Issue.get({
        issueId: $routeParams.issueId
      }, function(issue) {
        return $scope.issue = issue;
      });
    }
  ]);

}).call(this);
